From dd0a1437330c4be93f9cc2e8ba77752711298625 Mon Sep 17 00:00:00 2001
From: Benjamin Kampmann <ben.kampmann@gmail.com>
Date: Thu, 1 May 2014 14:25:20 +0200
Subject: [PATCH 2/3] prettify and move before Emberjs

---
 .../javascripts/ember-handlebars-injector.js       | 55 +++++++++++-----------
 app/assets/javascripts/vendor.js                   |  3 +-
 2 files changed, 29 insertions(+), 29 deletions(-)

diff --git a/app/assets/javascripts/ember-handlebars-injector.js b/app/assets/javascripts/ember-handlebars-injector.js
index a62643b..405c2c0 100644
--- a/app/assets/javascripts/ember-handlebars-injector.js
+++ b/app/assets/javascripts/ember-handlebars-injector.js
@@ -56,32 +56,34 @@
 
 
     var originalParse = Handlebars.parse;
-    Handlebars.parse = function(string){
-        var ast = originalParse(string);
-        var hash = md5(string);
-        if (DEBUG && finder.length && string.indexOf(finder) !== -1)
-                console.log("Finder found in " + hash + "\n", string);
-        if (patchers[hash]){
-            for(var i=0; i < patchers[hash].length; i++ ) {
-                try {
-                    var res = patchers[hash][i](ast, hash, string);
-                    if (res){
-                        ast = res;
+    var Patcher = function(){};
+    Patcher.prototype = {
+        parse: function(string){
+            var ast = originalParse(string),
+                hash = md5(string);
+            if (DEBUG && finder.length && string.indexOf(finder) !== -1)
+                    console.log("Finder found in " + hash + "\n", string);
+            if (patchers[hash]){
+                for(var i=0; i < patchers[hash].length; i++ ) {
+                    try {
+                        var res = patchers[hash][i](ast, hash, string);
+                        if (res){
+                            ast = res;
+                        }
+                    } catch (e) {
+                        window.console && console.warn(e);
                     }
-                } catch (e) {
-                    if (window.console) console.warn(e);
                 }
             }
-        }
-        return ast;
-    };
-
-    var Patcher = function(){};
-    Patcher.prototype = {
-        originalParse: originalParse,
-        addGeneralPatcher: function(hash, cb){
-            if (!patchers[hash]) patchers[hash] = [cb];
-            else patchers[hash].push(cb);
+            return ast;
+        },
+        addGeneralPatcher: function(hashes, cb){
+            if (typeof hashes === "string") hashes = [hashes];
+            for (var i=0;i < hashes.length; i++) {
+                var hash = hashes[i];
+                if (!patchers[hash]) patchers[hash] = [cb];
+                else patchers[hash].push(cb);
+            }
         },
         setFinder: function(exp){
             finder = exp;
@@ -112,10 +114,9 @@
             }
         },
         replaceWith: function(ast, pos, tmpl){
-            return Ember.TemplatePatcher.insertAt(ast, pos, tmpl, {replace: true});
+            return this.insertAt(ast, pos, tmpl, {replace: true});
         }
     };
-    if (window.Ember){
-        Ember.TemplatePatcher = new Patcher();
-    }
+    window.TemplatePatcher = new Patcher();
+    Handlebars.parse = window.TemplatePatcher.parse;
 })();
\ No newline at end of file
diff --git a/app/assets/javascripts/vendor.js b/app/assets/javascripts/vendor.js
index fadf199..991ecfa 100644
--- a/app/assets/javascripts/vendor.js
+++ b/app/assets/javascripts/vendor.js
@@ -2,6 +2,7 @@
 //= require ./discourse/lib/probes.js
 
 //= require handlebars.js
+//= require ember-handlebars-injector.js
 //= require jquery_include.js
 //= require ember_include.js
 
@@ -38,5 +39,3 @@
 //= require lock-on.js
 //= require ember-cloaking
 //= require break_string
-
-//= require ember-handlebars-injector.js
-- 
1.8.3.4 (Apple Git-47)

