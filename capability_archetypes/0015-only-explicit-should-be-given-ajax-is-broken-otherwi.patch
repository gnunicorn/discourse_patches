From 692173e25dbdcd597421348ec2415536b34d3a23 Mon Sep 17 00:00:00 2001
From: Benjamin Kampmann <ben.kampmann@gmail.com>
Date: Mon, 19 May 2014 11:50:48 +0200
Subject: [PATCH 15/18] only explicit should be given - ajax is broken
 otherwise

---
 config/routes.rb | 28 ++++++++++++++++------------
 1 file changed, 16 insertions(+), 12 deletions(-)

diff --git a/config/routes.rb b/config/routes.rb
index d1268db..1ae1b52 100644
--- a/config/routes.rb
+++ b/config/routes.rb
@@ -265,6 +265,10 @@ Discourse::Application.routes.draw do
   get "popular" => "list#popular_redirect"
 
   def categorizer(archetype)
+    defaults = {}
+    if archetype != ""
+      defaults[:archetype] = archetype
+    end
     resources :categories, :except => :show
     get "category/:id/show" => "categories#show"
     post "category/:category_id/move" => "categories#move"
@@ -274,27 +278,27 @@ Discourse::Application.routes.draw do
     get "category/:category/none" => "list#category_none_latest"
     get "category/:parent_category/:category" => "list#parent_category_category_latest"
 
-    get "top" => "list#top", defaults: { archetype: archetype }
-    get "category/:category/l/top" => "list#category_top", as: "category_top#{archetype}", defaults: { archetype: archetype }
-    get "category/:category/none/l/top" => "list#category_none_top", as: "category_none_top#{archetype}", defaults: { archetype: archetype }
-    get "category/:parent_category/:category/l/top" => "list#parent_category_category_top", as: "parent_category_category_top#{archetype}", defaults: { archetype: archetype }
+    get "top" => "list#top", defaults: defaults
+    get "category/:category/l/top" => "list#category_top", as: "category_top#{archetype}", defaults: defaults
+    get "category/:category/none/l/top" => "list#category_none_top", as: "category_none_top#{archetype}", defaults: defaults
+    get "category/:parent_category/:category/l/top" => "list#parent_category_category_top", as: "parent_category_category_top#{archetype}", defaults: defaults
 
     TopTopic.periods.each do |period|
       get "top/#{period}" => "list#top_#{period}"
-      get "category/:category/l/top/#{period}" => "list#category_top_#{period}", as: "category_top_#{period}#{archetype}", defaults: { archetype: archetype }
-      get "category/:category/none/l/top/#{period}" => "list#category_none_top_#{period}", as: "category_none_top_#{period}#{archetype}", defaults: { archetype: archetype }
-      get "category/:parent_category/:category/l/top/#{period}" => "list#parent_category_category_top_#{period}", as: "parent_category_category_top_#{period}#{archetype}", defaults: { archetype: archetype }
+      get "category/:category/l/top/#{period}" => "list#category_top_#{period}", as: "category_top_#{period}#{archetype}", defaults: defaults
+      get "category/:category/none/l/top/#{period}" => "list#category_none_top_#{period}", as: "category_none_top_#{period}#{archetype}", defaults: defaults
+      get "category/:parent_category/:category/l/top/#{period}" => "list#parent_category_category_top_#{period}", as: "parent_category_category_top_#{period}#{archetype}", defaults: defaults
     end
 
     Discourse.anonymous_filters.each do |filter|
-      get "#{filter}.rss" => "list##{filter}_feed", format: :rss, defaults: { archetype: archetype }
+      get "#{filter}.rss" => "list##{filter}_feed", format: :rss, defaults: defaults
     end
 
     Discourse.filters.each do |filter|
-      get "#{filter}" => "list##{filter}", defaults: { archetype: archetype }
-      get "category/:category/l/#{filter}" => "list#category_#{filter}", as: "category_#{filter}#{archetype}", defaults: { archetype: archetype }
-      get "category/:category/none/l/#{filter}" => "list#category_none_#{filter}", as: "category_none_#{filter}#{archetype}", defaults: { archetype: archetype }
-      get "category/:parent_category/:category/l/#{filter}" => "list#parent_category_category_#{filter}", as: "parent_category_category_#{filter}#{archetype}", defaults: { archetype: archetype }
+      get "#{filter}" => "list##{filter}", defaults: defaults
+      get "category/:category/l/#{filter}" => "list#category_#{filter}", as: "category_#{filter}#{archetype}", defaults: defaults
+      get "category/:category/none/l/#{filter}" => "list#category_none_#{filter}", as: "category_none_#{filter}#{archetype}", defaults: defaults
+      get "category/:parent_category/:category/l/#{filter}" => "list#parent_category_category_#{filter}", as: "parent_category_category_#{filter}#{archetype}", defaults: defaults
     end
   end
 
-- 
1.8.3.4 (Apple Git-47)

